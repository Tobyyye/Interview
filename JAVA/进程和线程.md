





### 一、进程 Process：（并行运算，分布式）

https://www.cnblogs.com/kirito-c/p/10306133.html



https://blog.csdn.net/qq_33867131/article/details/103161834



每一个进程，都可以看作是一个完整的 Program，它有自己完全独立的内容。不与其他进程直接共享数据。（一个工作(job)可以由多个 process 完成，例如电脑上的qq/360就会有好几个进程，这种程序可能会有一个守护进程，当主进程挂掉，它会自动重启主进程。）

每个进程可以由多个线程组成。进程抽象由操作系统提供，Linux 是使用 fork 函数，Windows 是用 CreateProccess。



1、运行一个程序就会产生一个进程，一个进程至少包含一个线程；

2、每启动一个进程，系统都会为其分配地址空间，建立数据表来维护代码段、堆栈段和数据段；

3、进程下的多个线程没有独立的地址空间，它们使用相同的地址空间共享数据，同一个进程下，线程共享全局变量，静态变量等数据；

4、多进程程序更安全，生命力更强，一个进程死掉不会对另一个进程造成影响（源于有独立的地址空间）；

5、线程程序更不易维护，一个线程死掉，整个进程就死掉了（因为共享地址空间）；

6、CPU切换一个线程比切换进程花费小；

7、创建一个线程比进程开销小；

8、线程占用的资源要⽐进程少很多；

9、协程不是被操作系统内核所管理，而完全是由程序所控制，

### 二、线程 Thread：（并发执行）

属于同一个进程的线程之间，是共享一套工作内容的。这使得线程的创建和移除开销很小，但同时也使编程变得复杂。

![img](https://img2018.cnblogs.com/blog/968138/201901/968138-20190122211054803-1107061658.png)





### 三、协程 Coroutine（并发执行）

如果说线程是轻量级的进程，那么协程就是轻量级的线程。线程跑在进程里，协程就跑在线程里。

优点：

1. 协程是跑在同一个线程里，并且是由程序本身来调度的。协程间的切换就是函数的调用，完全没有线程切换那么大的开销。
   - 线程的数量越多，协程的优势越大
2. 因为协程是程序调度的，它实际上是串行运行的，因此不需要复杂的锁机制来保证线程安全。
   - 在协程中控制共享资源不加锁，只需要判断状态就好了。这免去了锁机制带来的开销。

因为协程跑在单个线程内，所占用的 CPU 资源有限，所以多协程**并不能提升计算性能**。不仅如此，因为多了程序本身的调度开销，计算密集型程序的性能反而会下降。

此外，协程代码中**决不能出现阻塞**，否则整个线程都会停下来等待该操作完成，这就麻烦了。

协程适合用于 IO 密集型任务，可用于简化异步 IO 的 callback hell。例如 Python 的 asyncio 就是用协程实现的。



### 并发并行

由此，又引出两个名词：

1. 并发（Concurrent）：多个任务交替进行。

2. 并发：
   同一CPU时间片，只能处理一个程序。如果有多个程序，交替执行。

   程序1: ----- ------
   程序2: -----
   程序3: ----
   程序4: -----

3. 并行（Parallel）：多个任务同时进行。

4. 并行：
   同一CPU时间片内，CPU可以同时处理多个程序。如果有多个程序，同步执行。

   程序1：----------------
   程序2：----------------
   程序3：----------------
   程序4：----------------

![img](https://img2018.cnblogs.com/blog/968138/201901/968138-20190122211107519-374603992.png)



**Note**：进程 和 线程 都可能是 并发 或 并行 的。关键看你程序的运行状态。多核是并行的前提。并发则只要求交替执行，因此单核也没问题。



并发与并行

并发（concurrency）：把任务在不同的时间点交给处理器进行处理。在同一时间点，任务并不会同时运行。
并行（parallelism）：把每一个任务分配给每一个处理器独立完成。在同一时间点，任务一定是同时运行。
并发，是在同一个cpu上同时（不是真正的同时，而是看来是同时，因为cpu要在多个程序间切换）运行多个程序

（多个<3个>程序在在同一个cpu上运行）

![img](https://img-blog.csdnimg.cn/2019121909185245.png)

并行，多个<3个>程序在在多个cpu上运行




![img](https://img-blog.csdnimg.cn/20191219091814803.png)![img](https://img-blog.csdnimg.cn/20191219091814803.png

并发与并行



### 同步异步

1. 同步：不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，称这些程序单元是同步执行的。

   - 多线程编程中，所有修改共享变量的行为，都必须加锁，保证顺序执行，保证同步。或者加原子锁，保证该修改操作是原子的。
   - 同步意味着有序

2. 异步：为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式。

   - 不相关的程序单元之间可以是异步的。比如爬虫下载网页
   - 异步意味着无序

   

   

   **简单总结**

   - 进程是资源分配的单位
   - 线程是操作系统调度的单位
   - 进程切换需要的资源很最大，效率很低
   - 线程切换需要的资源一般，效率一般
   - 协程切换任务资源很小，效率高
   - 多进程、多线程根据cpu核数不一样可能是并行的 也可能是并发的。协程的本质就是使用当前进程在不同的函数代码中切换执行，可以理解为并行。 协程是一个用户层面的概念，不同协程的模型实现可能是单线程 也可能是多线程。

9、协程不是被操作系统内核所管理，而完全是由程序所控制，

   **极高的执行效率**：因为**子程序切换不是线程切换，而是由程序自身控制**，因此，**没有线程切换的开销**

![img](https://img-blog.csdnimg.cn/20191219085712123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODY3MTMx,size_16,color_FFFFFF,t_70)

