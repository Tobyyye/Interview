- b+ 树与 b 树的区别？ 
- 







B树


B树简单地说就是多叉树，每个叶子会存储数据，和指向下一个节点的指针。

例如要查找9，步骤如下

我们与根节点的关键字 (17，35）进行比较，9 小于 17 那么得到指针 P1；
按照指针 P1 找到磁盘块 2，关键字为（8，12），因为 9 在 8 和 12 之间，所以我们得到指针 P2；
按照指针 P2 找到磁盘块 6，关键字为（9，10），然后我们找到了关键字 9。
B+树


B+树是B树的改进，简单地说是：只有叶子节点才存数据，非叶子节点是存储的指针；所有叶子节点构成一个有序链表

B+树的内部节点并没有指向关键字具体信息的指针，因此其内部节点相对B树更小，如果把所有同一内部节点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多，一次性读入内存的需要查找的关键字也就越多，相对IO读写次数就降低了

例如要查找关键字16，步骤如下

与根节点的关键字 (1，18，35) 进行比较，16 在 1 和 18 之间，得到指针 P1（指向磁盘块 2）
找到磁盘块 2，关键字为（1，8，14），因为 16 大于 14，所以得到指针 P3（指向磁盘块 7）
找到磁盘块 7，关键字为（14，16，17），然后我们找到了关键字 16，所以可以找到关键字 16 所对应的数据。
B+树与B树的不同：

B+树非叶子节点不存在数据只存索引，B树非叶子节点存储数据
B+树查询效率更高。B+树使用双向链表串连所有叶子节点，区间查询效率更高（因为所有数据都在B+树的叶子节点，扫描数据库 只需扫一遍叶子结点就行了），但是B树则需要通过中序遍历才能完成查询范围的查找。
B+树查询效率更稳定。B+树每次都必须查询到叶子节点才能找到数据，而B树查询的数据可能不在叶子节点，也可能在，这样就会造成查询的效率的不稳定
B+树的磁盘读写代价更小。B+树的内部节点并没有指向关键字具体信息的指针，因此其内部节点相对B树更小，通常B+树矮更胖，高度小查询产生的I/O更少。

- 

## B+树相比B-树的优点

- B+树非叶子节点只存储key值，而B-树存储key值和data值，这样B+树每次读取时可以读取到更多的key值
- mysql进行区间访问时，由于B+树叶子节点之间用指针相连，只需要遍历所有的叶子节点即可；而B-树则需要中序遍历那样遍历
- B+树非叶子节点只存储key值，而B-树存储key值和data值，导致B+树的层级更少，查询效率更高
- B+树所有关键词地址都存在叶子节点上，所以每次查询次数都相同，比B-树稳定

## 为什么高度为3的B+树存储千万级数据？

> 解释这个问题的前提，mysql使用InnoDB引擎，mysql默认页文件大小为16k

假设我们一行数据大小为1k，那么一页存储16条数据，也就是说一个叶子节点能存储16条数据

再来看看非叶子节点，假设主键ID为bigint类型，那么长度为8B，指针大小在InnoDB引擎中的大小为6B，一共14B，那么一页中可以存放16k/14B=1170个(主键+指针)

也就是说高度为2的B+树可以存储的数据为:1170*16=18720条；高度为3的B+树可以存储的数据为:1170*1170*16=21902400(千万条数据)

**这也是为什么mysql可以支撑千万级别数据的原因**



https://www.jianshu.com/p/54effdb94bd6



https://www.jianshu.com/p/7ce804f97967







---------------------

B树的定义：

阶数：节点可以拥有最多的子树个数。

- 每个节点最多有M-1个键值
- 根节点至少有两个节点（否则不平衡）
- 所有节点的子树个数不大于M
- 每个节点中的键值都按照从小到大顺序排列
- 每个键值得左子树中所有的键值都小于它，右子树种的所有键值都大于它。位于M-1和M 键值（key）的子节点的值位于M-1和M 键值（key）对应的value之间。
- 内部节点（根节点之外的非叶子节点）至少有M/2个子节点
- 叶子节点出现在同一层次上，也就是树的高度绝对平衡。



![b-tree-01.png](http://www.apeit.cn/storage/article/2019/10/10/Egayj81X0NQA9O1vE6qElACD0BUksCPzJsobW2qK.png)











---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

https://www.cnblogs.com/lianzhilei/p/11250589.html







　　B+树是应文件系统所需而产生的B树的变形树，那么可能一定会想到，既然有了B树，又出一个B+树，那B+树必然是有很多优点的

 

**B+树的特征：**

- 有m个子树的中间节点包含有m个元素（B树中是k-1个元素），每个元素不保存数据，只用来索引；

- 所有的叶子结点中包含了全部关键字的信息，及指向含有这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大的顺序链接。 (而B 树的叶子节点并没有包括全部需要查找的信息)；

- 所有的非终端结点可以看成是索引部分，结点中仅含有其子树根结点中最大（或最小）关键字。 (而B 树的非终节点也包含需要查找的有效信息)；

- **为什么说B+树比B树更适合数据库索引？**

  1）B+树的磁盘读写代价更低

  　　B+树的内部结点并没有指向关键字具体信息的指针。因此其内部结点相对B 树更小。如果把所有同一内部结点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多。一次性读入内存中的需要查找的关键字也就越多。相对来说IO读写次数也就降低了；

  2）B+树查询效率更加稳定

  　　由于非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当；

  3）B+树便于范围查询（最重要的原因，范围查找是数据库的常态）

  　　B树在提高了IO性能的同时并没有解决元素遍历的我效率低下的问题，正是为了解决这个问题，B+树应用而生。B+树只需要去遍历叶子节点就可以实现整棵树的遍历。而且在数据库中基于范围的查询是非常频繁的，而B树不支持这样的操

  作或者说效率太低；不懂可以看看这篇解读-》[范围查找](https://zhuanlan.zhihu.com/p/54102723) 补充：B树的范围查找用的是中序遍历，而B+树用的是在链表上遍历；

- ![img](https://img2018.cnblogs.com/blog/997909/201907/997909-20190728114240297-169990922.png)

- 

- 























