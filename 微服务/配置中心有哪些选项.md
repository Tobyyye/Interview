配置中心有哪些选项？apollo 的架构？怎么无感实现已加载数据更新

Apollo：呼声很高，功能很强大，较成熟

Nacos：合并了注册中心的功能，开发中

Spring Cloud Config：知名度高，使用者广泛



## Apollo 的核心功能点

#### 1. 统一管理不同环境、不同集群的配置

Apollo 提供了一个统一界面，集中式管理不同环境（environment）、不同集群（cluster）、不同命名空间（namespace）的配置。
同一份代码部署在不同的集群，可以有不同的配置，比如 zk 的地址等。通过命名空间（namespace）可以很方便地支持多个不同应用共享同一份配置，同时还允许应用对共享的配置进行覆盖。

#### 2. 配置修改实时生效（热发布）

用户在 Apollo 修改完配置并发布后，客户端能实时（1s）接收到最新的配置，并通知到应用程序。
所有的配置发布都有版本概念，从而可以方便地支持配置的回滚。

#### 4. 灰度发布

支持配置的灰度发布，比如点击发布后，只对部分应用实例生效，等观察一段时间，确定没问题后再推给所有应用实例。
应用和配置的管理都有完善的权限管理机制，对配置的管理还分为编辑和发布两个环节，从而减少人为的错误。

#### 6. 客户端配置信息监控

可以方便地看到配置被哪些实例使用。
提供了 Java 和 .Net 的原生客户端，方便应用集成。支持 Spring Placeholder、Annotation 和 Spring Boot 的 ConfigurationProperties，方便应用使用（需要 Spring 3.1.1+）。

Apollo 自身提供了比较完善的统一配置管理界面，支持多环境、多数据中心配置管理、权限、流程治理等特性。不过 Apollo 出于通用性考虑，对配置的修改不会做过多限制，只要符合基本的格式就能够保存。

对于这类应用，Apollo 支持应用方通过开放接口在 Apollo 进行配置的修改和发布，并且具备完善的授权和权限控制。

#### 9. 部署简单

配置中心作为基础服务，对可用性要求非常高，这就需要 Apollo 对外部依赖尽可能地少。
目前唯一的外部依赖是 ，所以部署非常简单，只要安装好 Java 和 MySQL 就可以让 Apollo 跑起来。

## Apollo 核心概念

#### 1. 应用

应用就是我们的项目，Apollo 客户端在运行时需要知道应用的标识，从而可以根据这个标识去配置中心获取对应的配置。应用的标识用 APPid 来指定，指定 APPid 的方式有多种，Spring Boot 项目中建议直接配置在 application.properties 中，跟着项目走。
环境就是常见的开发、测试、生产等，不同的环境对应的配置内容不一样。Apollo 客户端在运行时除了需要知道项目当前的身份标识，还需要知道当前项目对应的环境，从而可以根据环境去配置中心获取对应的配置。

目前支持的环境有 Local（本地环境，加载本地配置）、DEV（开发环境）、FAT（测试环境）、UAT（集成环境）、PRO（生产环境）。

#### 3. 集群

在多机房的环境下，针对不同的机房，我们可以划分出不同的集群，集群可以拥有不同的配置。指定项目对应集群的方式有多种，可以通过 Java System Property 或者配置文件来指定。
命名空间可以用来对配置做分类，不同类型的配置存放在不同的命名空间中，如数据库配置文件、消息队列配置、业务相关的配置等。命名空间还有一个公共的特性，那就是让多个项目共用同一份配置，比如 集群配置。通过权限控制可以防止配置被不相干的人误操作。对于开发人员，可以只分配测试环境的修改权限和发布权限，只有负责人才能有正式环境的权限。



怎么无感实现已加载数据更新

Apollo配置中心动态生效机制，是基于Http长轮询请求和Spring扩展机制实现的，在Spring容器启动过程中，Apollo通过自定义的BeanPostProcessor和BeanFactoryPostProcessor將参数中包含${…}占位符和@Value注解的Bean注册到Apollo框架中定义的注册表中。然后通过Http长轮询不断的去获取服务端的配置信息，一旦配置发生变化，Apollo会根据变化的配置的Key找到对应的Bean，然后修改Bean的属性，从而实现了配置动态生效的特性。

需要注意的是，Apollo在配置变化后，只能修改Bean的属性，例如我们数据源的属性发生变化，新创建的Connection对象是没问题的，但是连接池中已经创建的Connection对象相关信息是不能动态修改的，所以依然需要重启应用。